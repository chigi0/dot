#!/bin/bash

# The test script generated by grok xAI
# "https://console.x.ai/team/18578cf9-661e-4096-b79c-b3049702b2d9/api-keys/create"
# The key used here is my second API key
# This script does nothing but returns Hello World

# curl https://api.x.ai/v1/chat/completions \
#   -H "Content-Type: application/json" \
#   -H "Authorization: Bearer xai-E9hH4qCeyJrka72sUo2UFMyru40PaTgNPhQpqMr1zxSOiPo1Sww3pAfwlKziHrD7KZ9xwGqHrpORz4mq" \
#   -d '{
#   "messages": [
#     {
#       "role": "system",
#       "content": "You are a test assistant."
#     },
#     {
#       "role": "user",
#       "content": "Testing. Just say hi and hello world and nothing else."
#     }
#   ],
#   "model": "grok-3-latest",
#   "stream": false,
#   "temperature": 0
# }'

# Path to the file containing the xAI API key
TOKEN_FILE="$HOME/.config/grok/key"

# Check if the token file exists
if [[ ! -f "$TOKEN_FILE" ]]; then
    echo "Error: xAI API key file '$TOKEN_FILE' not found!"
    exit 1
fi

# Read the xAI API key from the file
API_TOKEN=$(cat "$TOKEN_FILE" | tr -d '\n')

# Check if the token is empty
if [[ -z "$API_TOKEN" ]]; then
    echo "Error: xAI API key file is empty!"
    exit 1
fi

# Export the xAI API key as an environment variable for mods to use
export OPENAI_API_KEY="$API_TOKEN"

# Run the mods program with the xAI API, Grok model, and titled conversation
if [[ -f "$HOME/.local/share/mods/grok.json" ]]; then
    /usr/bin/mods -a openai -m grok-3-latest --continue='grok' "$@"
else
    /usr/bin/mods -a openai -m grok-3-latest --title='grok' "$@"
fi

# Optionally unset the environment variable after execution
unset OPENAI_API_KEY
